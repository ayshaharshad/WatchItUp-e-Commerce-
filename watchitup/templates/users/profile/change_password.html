<!-- ========================================
     7. change_password.html
     ======================================== -->
{% extends "users/profile/base.html" %}

{% block page_title %}Change Password{% endblock %}
{% block page_icon %}fas fa-key{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item active">Change Password</li>
{% endblock %}

{% block page_actions %}
<a href="{% url 'users:profile' %}" class="btn btn-outline-secondary btn-sm">
    <i class="fas fa-arrow-left me-1"></i>Back
</a>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="alert alert-info">
            <i class="fas fa-shield-alt me-2"></i>
            <strong>Security:</strong> After changing password, all other sessions will be terminated.
        </div>

        <div class="card">
            <div class="card-header"><i class="fas fa-info-circle me-2"></i>Password Requirements</div>
            <div class="card-body">
                <ul class="mb-0" style="list-style: none; padding-left: 0;">
                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>At least 8 characters</li>
                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>One uppercase letter</li>
                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>One lowercase letter</li>
                    <li class="mb-0"><i class="fas fa-check-circle text-success me-2"></i>One number</li>
                </ul>
            </div>
        </div>

        <form method="post">
            {% csrf_token %}
            
            <div class="card">
                <div class="card-header"><i class="fas fa-key me-2"></i>Change Password</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="id_current_password" class="form-label">Current Password <span class="text-danger">*</span></label>
                        {{ form.current_password }}
                        {% if form.current_password.errors %}<div class="text-danger small">{{ form.current_password.errors.0 }}</div>{% endif %}
                    </div>
                    <div class="mb-3">
                        <label for="id_new_password" class="form-label">New Password <span class="text-danger">*</span></label>
                        {{ form.new_password }}
                        <div class="mt-2" style="height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden;">
                            <div id="strength-bar" style="height: 100%; width: 0%; transition: all 0.3s;"></div>
                        </div>
                        <small id="strength-text" class="text-muted">Enter password to check strength</small>
                        {% if form.new_password.errors %}<div class="text-danger small">{{ form.new_password.errors.0 }}</div>{% endif %}
                    </div>
                    <div class="mb-3">
                        <label for="id_confirm_password" class="form-label">Confirm New Password <span class="text-danger">*</span></label>
                        {{ form.confirm_password }}
                        <div id="match-indicator" class="mt-1"></div>
                        {% if form.confirm_password.errors %}<div class="text-danger small">{{ form.confirm_password.errors.0 }}</div>{% endif %}
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-between">
                <a href="{% url 'users:profile' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-times me-1"></i>Cancel
                </a>
                <button type="submit" class="btn btn-warning">
                    <i class="fas fa-key me-1"></i>Change Password
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
const newPass = document.getElementById('id_new_password');
const confirmPass = document.getElementById('id_confirm_password');
const strengthBar = document.getElementById('strength-bar');
const strengthText = document.getElementById('strength-text');
const matchIndicator = document.getElementById('match-indicator');

newPass.addEventListener('input', function() {
    const val = this.value;
    let strength = 0;
    
    if (val.length >= 8) strength++;
    if (/[a-z]/.test(val)) strength++;
    if (/[A-Z]/.test(val)) strength++;
    if (/[0-9]/.test(val)) strength++;
    
    const colors = ['#ef4444', '#f59e0b', '#3b82f6', '#10b981'];
    const texts = ['Weak', 'Fair', 'Good', 'Strong'];
    
    strengthBar.style.width = (strength * 25) + '%';
    strengthBar.style.background = colors[strength - 1] || '#e5e7eb';
    strengthText.textContent = val ? texts[strength - 1] || 'Very Weak' : 'Enter password';
    
    checkMatch();
});

confirmPass.addEventListener('input', checkMatch);

function checkMatch() {
    if (confirmPass.value) {
        if (newPass.value === confirmPass.value) {
            matchIndicator.innerHTML = '<small class="text-success"><i class="fas fa-check me-1"></i>Passwords match</small>';
        } else {
            matchIndicator.innerHTML = '<small class="text-danger"><i class="fas fa-times me-1"></i>Passwords do not match</small>';
        }
    } else {
        matchIndicator.innerHTML = '';
    }
}
</script>
{% endblock %}