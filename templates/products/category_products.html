{% extends 'products/base.html' %}
{% load static %}

{% block content %}
<div class="breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col">
                <p class="bread"><span><a href="{% url 'products:home' %}">Home</a></span> / <span>{{ category_title }}</span></p>
            </div>
        </div>
    </div>
</div>

<div class="colorlib-shop">
    <div class="container">
        <div class="row">
            <!-- Sidebar Filters -->
            <div class="col-lg-3 col-md-3">
                <div class="row">
                    <!-- Search Form -->
                    <div class="col-md-12">
                        <div class="sidebar-box">
                            <h3>Search {{ category_title }}</h3>
                            <form method="get" class="search-form">
                                <input type="hidden" name="min_price" value="{{ min_price }}">
                                <input type="hidden" name="max_price" value="{{ max_price }}">
                                <input type="hidden" name="sort" value="{{ sort_by }}">
                                
                                <div class="form-group">
                                    <input type="text" name="q" class="form-control" placeholder="Search watches..." value="{{ search_query }}">
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn btn-primary btn-sm">Search</button>
                                    {% if search_query or min_price or max_price %}
                                        <a href="{{ request.resolver_match.url_name|add:':' }}" class="btn btn-secondary btn-sm ml-2">Clear All</a>
                                    {% endif %}
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Price Filter -->
                    <div class="col-md-12">
                        <div class="sidebar-box">
                            <h3>Price Range</h3>
                            <form method="get" class="price-form">
                                <input type="hidden" name="q" value="{{ search_query }}">
                                <input type="hidden" name="sort" value="{{ sort_by }}">
                                
                                <div class="form-group">
                                    <label>Min Price:</label>
                                    <input type="number" name="min_price" class="form-control" placeholder="Min" value="{{ min_price }}" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>Max Price:</label>
                                    <input type="number" name="max_price" class="form-control" placeholder="Max" value="{{ max_price }}" step="0.01">
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn btn-primary btn-sm">Filter</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="col-lg-9 col-md-9">
                <div class="row">
                    <!-- Category Title and Sort -->
                    <div class="col-md-12">
                        <div class="category-header mb-4">
                            <h2>{{ category_title }}</h2>
                        </div>
                        
                        <div class="shop-top d-flex justify-content-between align-items-center mb-4">
                            <div class="shop-result">
                                <p>Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ total_products }} results</p>
                            </div>
                            <div class="shop-sort">
                                <form method="get" class="sort-form">
                                    <input type="hidden" name="q" value="{{ search_query }}">
                                    <input type="hidden" name="min_price" value="{{ min_price }}">
                                    <input type="hidden" name="max_price" value="{{ max_price }}">
                                    
                                    <select name="sort" class="form-control" onchange="this.form.submit()">
                                        <option value="">Sort by</option>
                                        <option value="price_low" {% if sort_by == 'price_low' %}selected{% endif %}>Price: Low to High</option>
                                        <option value="price_high" {% if sort_by == 'price_high' %}selected{% endif %}>Price: High to Low</option>
                                        <option value="name_asc" {% if sort_by == 'name_asc' %}selected{% endif %}>Name: A-Z</option>
                                        <option value="name_desc" {% if sort_by == 'name_desc' %}selected{% endif %}>Name: Z-A</option>
                                    </select>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Products -->
                    {% if products %}
                        {% for product in products %}
                        <div class="col-lg-4 col-md-6 mb-4 text-center">
                            <div class="product-entry border">
                                <a href="{% url 'products:product_detail' product.uuid %}" class="prod-img">
                                    {% if product.images.first %}
                                        <img src="{{ product.images.first.image.url }}" class="img-fluid" alt="{{ product.name }}">
                                    {% else %}
                                        <img src="{% static 'products/images/no-image.jpg' %}" class="img-fluid" alt="No Image">
                                    {% endif %}
                                </a>
                                <div class="desc">
                                    <h2><a href="{% url 'products:product_detail' product.uuid %}">{{ product.name }}</a></h2>
                                    {% if product.brand %}
                                        <span class="brand">{{ product.brand.name }}</span>
                                    {% endif %}
                                    <span class="price">â‚¹{{ product.base_price }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="col-md-12">
                            <div class="alert alert-info text-center">
                                <h4>No {{ category_title|lower }} found</h4>
                                <p>Try adjusting your search or filter criteria.</p>
                                <a href="{% url request.resolver_match.url_name %}" class="btn btn-primary">View All {{ category_title }}</a>
                            </div>
                        </div>
                    {% endif %}
                </div>

                <!-- Pagination -->
                {% if page_obj.has_other_pages %}
                <div class="row">
                    <div class="col text-center">
                        <div class="block-27">
                            <ul class="pagination">
                                {% if page_obj.has_previous %}
                                    <li><a href="?page=1{% if query_string %}&{{ query_string }}{% endif %}">&lt;</a></li>
                                    <li><a href="?page={{ page_obj.previous_page_number }}{% if query_string %}&{{ query_string }}{% endif %}">Previous</a></li>
                                {% endif %}

                                {% for num in page_obj.paginator.page_range %}
                                    {% if page_obj.number == num %}
                                        <li class="active"><span>{{ num }}</span></li>
                                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                        <li><a href="?page={{ num }}{% if query_string %}&{{ query_string }}{% endif %}">{{ num }}</a></li>
                                    {% endif %}
                                {% endfor %}

                                {% if page_obj.has_next %}
                                    <li><a href="?page={{ page_obj.next_page_number }}{% if query_string %}&{{ query_string }}{% endif %}">Next</a></li>
                                    <li><a href="?page={{ page_obj.paginator.num_pages }}{% if query_string %}&{{ query_string }}{% endif %}">&gt;</a></li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
.category-header h2 {
    color: #333;
    font-size: 28px;
    font-weight: 600;
    margin-bottom: 10px;
}
.shop-top {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 20px;
}
.sidebar-box {
    background: #fff;
    padding: 20px;
    margin-bottom: 30px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.sidebar-box h3 {
    margin-bottom: 15px;
    color: #333;
    font-size: 18px;
}
.price-form .form-group {
    margin-bottom: 15px;
}
.price-form label {
    font-weight: 500;
    margin-bottom: 5px;
}
.product-entry {
    transition: transform 0.3s ease;
}
.product-entry:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.brand {
    display: block;
    color: #666;
    font-size: 14px;
    margin-bottom: 5px;
}
</style>
{% endblock %}
